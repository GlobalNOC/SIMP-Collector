#!/usr/bin/perl

use strict;
use warnings;

use Getopt::Long;
use GRNOC::Log;
#use GRNOC::OESS::Collector::Master;

my $conf_file = '/etc/grnoc/oess-vlan-collector/config.xml';
my $logging_file = '/etc/grnoc/oess-vlan-collector/logging.conf';
my $pidfile = '/var/run/oess-vlan-collector.pid';
my $nofork = 0;
my $help;

GetOptions( 'config=s' => \$conf_file,
	    'logging=s' => \$logging_file,
	    'pidfile=s' => \$pidfile,
	    'nofork' => \$nofork,
	    'help|h|?' => \$help,
    );

usage() if ($help); 

my $grnoc_log = GRNOC::Log->new(config => $logging_file);

my $collector = GRNOC::OESS::Collector::Master->new(
    config_file => $conf_file,
    pidfile => $pidfile,
    daemonize => !$nofork
    );

$collector->start();

sub usage {
    print "$0 [--config <config_file>] [--logging <logging_file>] [--pidfile pidfile]\n";
    print "\t--nofork - Do not daemonize\n";
    exit(1);
}
